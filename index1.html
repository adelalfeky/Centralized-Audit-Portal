<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Centralized Audit Requirement Portal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .card-shadow { box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08); }
        .status-pending { background-color: #fef3c7; color: #92400e; }
        .status-in-progress { background-color: #dbeafe; color: #1e40af; }
        .status-completed { background-color: #d1fae5; color: #065f46; }
        .status-overdue { background-color: #fee2e2; color: #991b1b; }
        .tab-active { border-bottom: 3px solid #3b82f6; color: #3b82f6; }
        .highlight-row { background-color: #f0f9ff; }
        .slide-in { animation: slideIn 0.3s ease-out; }
        @keyframes slideIn {
            from { transform: translateY(10px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Header -->
    <header class="bg-white shadow-sm">
        <div class="container mx-auto px-4 py-4">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <div class="flex items-center space-x-3 mb-4 md:mb-0">
                    <div class="bg-blue-600 text-white p-3 rounded-lg">
                        <i class="fas fa-clipboard-check text-xl"></i>
                    </div>
                    <div>
                        <h1 class="text-2xl font-bold text-gray-800">Centralized Audit Requirement Portal</h1>
                        <p class="text-gray-600">Tasheer - Entity-wide Diagnostic Assessment Review</p>
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="text-right">
                        <p class="font-medium text-gray-800">Welcome, Department Manager</p>
                        <p class="text-sm text-gray-600" id="current-dept">Corporate IT</p>
                    </div>
                    <div class="relative">
                        <button id="user-menu" class="bg-gray-200 h-10 w-10 rounded-full flex items-center justify-center">
                            <i class="fas fa-user text-gray-700"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Dashboard Stats -->
    <div class="container mx-auto px-4 py-6">
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
            <div class="bg-white card-shadow rounded-lg p-5">
                <div class="flex justify-between items-center">
                    <div>
                        <p class="text-gray-500 text-sm">Total Requirements</p>
                        <p class="text-3xl font-bold text-gray-800" id="total-reqs">41</p>
                    </div>
                    <div class="bg-blue-100 p-3 rounded-full">
                        <i class="fas fa-list-check text-blue-600 text-xl"></i>
                    </div>
                </div>
            </div>
            
            <div class="bg-white card-shadow rounded-lg p-5">
                <div class="flex justify-between items-center">
                    <div>
                        <p class="text-gray-500 text-sm">Pending</p>
                        <p class="text-3xl font-bold text-gray-800" id="pending-reqs">41</p>
                    </div>
                    <div class="bg-yellow-100 p-3 rounded-full">
                        <i class="fas fa-clock text-yellow-600 text-xl"></i>
                    </div>
                </div>
            </div>
            
            <div class="bg-white card-shadow rounded-lg p-5">
                <div class="flex justify-between items-center">
                    <div>
                        <p class="text-gray-500 text-sm">In Progress</p>
                        <p class="text-3xl font-bold text-gray-800" id="progress-reqs">0</p>
                    </div>
                    <div class="bg-blue-100 p-3 rounded-full">
                        <i class="fas fa-spinner text-blue-600 text-xl"></i>
                    </div>
                </div>
            </div>
            
            <div class="bg-white card-shadow rounded-lg p-5">
                <div class="flex justify-between items-center">
                    <div>
                        <p class="text-gray-500 text-sm">Completed</p>
                        <p class="text-3xl font-bold text-gray-800" id="completed-reqs">0</p>
                    </div>
                    <div class="bg-green-100 p-3 rounded-full">
                        <i class="fas fa-check-circle text-green-600 text-xl"></i>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Main Content Area -->
        <div class="bg-white card-shadow rounded-lg overflow-hidden">
            <!-- Department Selector Tabs -->
            <div class="border-b border-gray-200">
                <div class="px-6 pt-4">
                    <h2 class="text-lg font-semibold text-gray-800 mb-2">Select Department</h2>
                    <div class="flex flex-wrap gap-2" id="department-tabs">
                        <!-- Tabs will be generated by JavaScript -->
                    </div>
                </div>
            </div>
            
            <!-- Filter and Actions Bar -->
            <div class="px-6 py-4 border-b border-gray-200 flex flex-col md:flex-row justify-between items-center">
                <div class="mb-4 md:mb-0">
                    <h3 class="text-xl font-bold text-gray-800" id="department-title">Corporate IT - Requirements</h3>
                    <p class="text-gray-600">Request Date: 02 Feb 2026 | Deadline: 28 Feb 2026</p>
                </div>
                
                <div class="flex flex-wrap gap-3">
                    <div class="relative">
                        <select id="status-filter" class="border border-gray-300 rounded-lg px-4 py-2 pr-10 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            <option value="all">All Status</option>
                            <option value="pending">Pending</option>
                            <option value="in-progress">In Progress</option>
                            <option value="completed">Completed</option>
                            <option value="overdue">Overdue</option>
                        </select>
                        <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700">
                            <i class="fas fa-filter"></i>
                        </div>
                    </div>
                    
                    <button id="export-btn" class="bg-gray-100 hover:bg-gray-200 text-gray-800 font-medium py-2 px-4 rounded-lg flex items-center">
                        <i class="fas fa-download mr-2"></i> Export
                    </button>
                    
                    <button id="submit-all-btn" class="bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-lg flex items-center">
                        <i class="fas fa-paper-plane mr-2"></i> Submit All
                    </button>
                </div>
            </div>
            
            <!-- Requirements Table -->
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Sr. No.</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Information Requested</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Request Date</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="requirements-table" class="bg-white divide-y divide-gray-200">
                        <!-- Table rows will be generated by JavaScript -->
                    </tbody>
                </table>
            </div>
            
            <!-- Pagination -->
            <div class="px-6 py-4 border-t border-gray-200 flex items-center justify-between">
                <div class="text-sm text-gray-700">
                    Showing <span id="start-item">1</span> to <span id="end-item">10</span> of <span id="total-items">41</span> requirements
                </div>
                <div class="flex space-x-2">
                    <button id="prev-page" class="px-3 py-1 rounded border border-gray-300 text-gray-700 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    <button id="next-page" class="px-3 py-1 rounded border border-gray-300 text-gray-700 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Upload Modal -->
        <div id="upload-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-50">
            <div class="relative top-20 mx-auto p-5 border w-11/12 md:w-1/2 shadow-lg rounded-md bg-white slide-in">
                <div class="flex justify-between items-center pb-3 border-b">
                    <h3 class="text-xl font-bold text-gray-800" id="modal-title">Update Requirement Status</h3>
                    <button id="close-modal" class="text-gray-400 hover:text-gray-600">
                        <i class="fas fa-times text-2xl"></i>
                    </button>
                </div>
                
                <div class="py-4">
                    <div class="mb-6 p-4 bg-blue-50 rounded-lg">
                        <h4 class="font-medium text-blue-800 mb-1" id="requirement-title">Approved Org structure</h4>
                        <p class="text-blue-700 text-sm" id="requirement-detail">Corporate IT - Requirement #1</p>
                    </div>
                    
                    <div class="mb-6">
                        <label class="block text-gray-700 text-sm font-medium mb-2">Status</label>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                            <button data-status="pending" class="status-btn flex flex-col items-center justify-center p-3 rounded-lg border border-gray-300 hover:border-yellow-500 bg-white">
                                <div class="status-pending rounded-full p-2 mb-2">
                                    <i class="fas fa-clock"></i>
                                </div>
                                <span class="text-sm font-medium">Pending</span>
                            </button>
                            <button data-status="in-progress" class="status-btn flex flex-col items-center justify-center p-3 rounded-lg border border-gray-300 hover:border-blue-500 bg-white">
                                <div class="status-in-progress rounded-full p-2 mb-2">
                                    <i class="fas fa-spinner"></i>
                                </div>
                                <span class="text-sm font-medium">In Progress</span>
                            </button>
                            <button data-status="completed" class="status-btn flex flex-col items-center justify-center p-3 rounded-lg border border-gray-300 hover:border-green-500 bg-white">
                                <div class="status-completed rounded-full p-2 mb-2">
                                    <i class="fas fa-check-circle"></i>
                                </div>
                                <span class="text-sm font-medium">Completed</span>
                            </button>
                            <button data-status="overdue" class="status-btn flex flex-col items-center justify-center p-3 rounded-lg border border-gray-300 hover:border-red-500 bg-white">
                                <div class="status-overdue rounded-full p-2 mb-2">
                                    <i class="fas fa-exclamation-circle"></i>
                                </div>
                                <span class="text-sm font-medium">Overdue</span>
                            </button>
                        </div>
                    </div>
                    
                    <div class="mb-6">
                        <label for="receiving-date" class="block text-gray-700 text-sm font-medium mb-2">Receiving Date</label>
                        <input type="date" id="receiving-date" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    
                    <div class="mb-6">
                        <label for="remarks" class="block text-gray-700 text-sm font-medium mb-2">Remarks/Notes</label>
                        <textarea id="remarks" rows="3" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="Add any comments or notes about this requirement..."></textarea>
                    </div>
                    
                    <div class="mb-6">
                        <label class="block text-gray-700 text-sm font-medium mb-2">Upload Supporting Document (Optional)</label>
                        <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center">
                            <i class="fas fa-cloud-upload-alt text-3xl text-gray-400 mb-3"></i>
                            <p class="text-gray-600 mb-2">Drag & drop files here or</p>
                            <label for="file-upload" class="cursor-pointer bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-lg inline-block">
                                <i class="fas fa-upload mr-2"></i> Browse Files
                            </label>
                            <input type="file" id="file-upload" class="hidden" multiple>
                            <p class="text-gray-500 text-xs mt-3">Maximum file size: 10MB. Supported formats: PDF, DOC, XLS, JPG, PNG</p>
                        </div>
                        <div id="file-list" class="mt-3 space-y-2"></div>
                    </div>
                </div>
                
                <div class="flex justify-end space-x-3 pt-4 border-t">
                    <button id="cancel-modal" class="px-5 py-2.5 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 font-medium">Cancel</button>
                    <button id="save-status" class="px-5 py-2.5 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium">Save Changes</button>
                    <button id="submit-status" class="px-5 py-2.5 bg-green-600 hover:bg-green-700 text-white rounded-lg font-medium">
                        <i class="fas fa-paper-plane mr-2"></i> Submit
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Confirmation Toast -->
        <div id="confirmation-toast" class="fixed bottom-4 right-4 bg-green-600 text-white p-4 rounded-lg shadow-lg hidden z-50 slide-in">
            <div class="flex items-center">
                <i class="fas fa-check-circle text-xl mr-3"></i>
                <div>
                    <p class="font-medium">Status updated successfully!</p>
                    <p class="text-sm opacity-90">Your changes have been saved to the portal.</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Department data extracted from the provided files
        const departments = [
            {
                id: 'corporate-it',
                name: 'Corporate IT',
                requirements: [
                    { id: 1, description: 'Approved Org structure', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 2, description: 'Approved Strategy', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 3, description: 'Approved policies and procedures', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 4, description: 'Approved functional statement defining the department’s roles and responsibilities', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 5, description: 'Approved department objectives aligned with the company’s strategic objectives', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 6, description: 'Approved list of key performance indicators (KPIs) and performance metrics used by the department', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 7, description: 'Approved Job Descriptions (JDs) for department employees', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 8, description: 'Department risk register', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 9, description: 'List of all reports generated by the department (including report type, purpose, frequency, and target audience), with samples of those reports', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 10, description: 'Approved department annual plan / work plan', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 11, description: 'Latest Internal Audit reports relevant to the department and other reports from other assurance providers, if applicable', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 12, description: 'List of external stakeholders, regulators, and oversight bodies the department interacts with', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 13, description: 'List of applicable laws, regulations, and other mandatory compliance obligations monitored by the department in relation to its operations', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 14, description: 'Approved Delegation of Authority (DoA) and/or RACI matrix applicable to the department (if available)', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 15, description: 'IT Enterprise Architecture document', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 16, description: 'IT budget for 2025', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 17, description: 'IT service catalogue', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 18, description: 'Service Level Agreements between IT and business departments', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 19, description: 'List of IT projects in 2025', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 20, description: 'IT performance report (servers utilization, UPS, capacity reports)', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 21, description: 'IT asset register', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 22, description: 'Current Network Topology and Diagram', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 23, description: 'List of Network devices and their details', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 24, description: 'Multi-Factor Authentication (MFA) Configuration', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 25, description: 'Password Storage Encryption Details', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 26, description: 'Password setting on Domain Controller', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 27, description: 'Access Workflow approvals', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 28, description: 'User Access Review Document', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 29, description: 'Business Continuity and Disaster Recovery policy, procedure, and plans', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 30, description: 'Test plans and reports for Business Continuity and Disaster Recovery', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 31, description: 'Latest Business Impact Analysis (BIA) report', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 32, description: 'IT Risk Management Framework', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 33, description: 'IT Risk Register', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 34, description: 'Approved Job description for IT staff from HR', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 35, description: 'IT succession plan', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 36, description: 'List of Trainings planned/provided for IT staff', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 37, description: 'Records of training needs assessments', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 38, description: 'Email notification for training', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 39, description: 'IT approved vendors list', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 40, description: 'IT vendors contracts', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 41, description: 'Technology Maturity Assessment Reports', requestDate: '2026-02-02', status: 'pending', remarks: '' }
                ]
            },
            {
                id: 'data-analytics',
                name: 'Data Analytics & Business Intelligence',
                requirements: [
                    { id: 1, description: 'Data governance policies and procedures', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 2, description: 'Approved functional statement defining the department’s roles and responsibilities', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 3, description: 'Approved department objectives aligned with the company’s strategic objectives', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 4, description: 'Approved list of key performance indicators (KPIs) and performance metrics used by the department', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 5, description: 'Approved Job Descriptions (JDs) for department employees', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 6, description: 'Department risk register', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 7, description: 'List of all reports generated by the department (including report type, purpose, frequency, and target audience), with samples of those reports', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 8, description: 'Approved department annual plan / work plan', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 9, description: 'Latest Internal Audit reports relevant to the department and other reports from other assurance providers, if applicable', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 10, description: 'List of external stakeholders, regulators, and oversight bodies the department interacts with', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 11, description: 'List of applicable laws, regulations, and other mandatory compliance obligations monitored by the department in relation to its operations', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 12, description: 'Approved Delegation of Authority (DoA) and/or RACI matrix applicable to the department (if available)', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 13, description: 'Approved organizational structure of the department (showing reporting lines)', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 14, description: 'Approved Data Analytics & Business Intelligence framework and operating model', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 15, description: 'Defined roles and responsibilities (data owners, data stewards, BI developers)', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 16, description: 'Documented data architecture (source systems, data warehouse, data marts)', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 17, description: 'Data integration and ETL processes documentation', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 18, description: 'List of all data sources feeding BI solutions', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 19, description: 'Data lineage and dependency mapping', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 20, description: 'Data quality framework and standards', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 21, description: 'Data quality rules, thresholds, and monitoring reports', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 22, description: 'Issue logs for data quality defects and remediation actions', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 23, description: 'List of all BI dashboards and analytical reports produced during FY2024–FY2025', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 24, description: 'List of analytical models (predictive, prescriptive) used', requestDate: '2026-02-02', status: 'pending', remarks: '' }
                ]
            },
            {
                id: 'infrastructure',
                name: 'Infrastructure & Operations',
                requirements: [
                    { id: 1, description: 'Approved org structure', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 2, description: 'Approved policies and procedures', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 3, description: 'Approved functional statement defining the department’s roles and responsibilities', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 4, description: 'Approved department objectives aligned with the company’s strategic objectives', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 5, description: 'Approved list of key performance indicators (KPIs) and performance metrics used by the department', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 6, description: 'Approved Job Descriptions (JDs) for department employees', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 7, description: 'Department risk register', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 8, description: 'List of all reports generated by the department (including report type, purpose, frequency, and target audience), with samples of those reports', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 9, description: 'Approved department annual plan / work plan', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 10, description: 'Latest Internal Audit reports relevant to the department and other reports from other assurance providers, if applicable', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 11, description: 'List of external stakeholders, regulators, and oversight bodies the department interacts with', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 12, description: 'List of applicable laws, regulations, and other mandatory compliance obligations monitored by the department in relation to its operations', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 13, description: 'Approved Delegation of Authority (DoA) and/or RACI matrix applicable to the department (if available)', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 14, description: 'Approved organizational structure of the department (showing reporting lines)', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 15, description: 'Approved IT performance metrics', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 16, description: 'IT performance report (servers utilization, UPS, capacity reports)', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 17, description: 'Monitoring tools for infrastructure availability and performance', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 18, description: 'Samples of IT performance reports / emails', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 19, description: 'List of backup performed in 2025', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 20, description: 'List of backup restoration process performed in 2025', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 21, description: 'IT asset register of all infrastructure assets, including hardware, software, and licenses', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 22, description: 'List of Network devices and their details', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 23, description: 'Current Network Topology and Diagram', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 24, description: 'List of available Database and Operating Systems, servers, admins, versions', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 25, description: 'List of incident tickets raised in 2025', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 26, description: 'Incident classification and categorization methodology', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 27, description: 'Problems logged for recurring incidents (problem management)', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 28, description: 'Reports prepared and published to management on service requests', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 29, description: 'Change Advisory Board Charter', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 30, description: 'List of changes (System generated) in 2025', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 31, description: 'List of changes (Manual list) in 2025', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 32, description: 'Network change management logs / tickets', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 33, description: 'Security controls implemented at the infrastructure level, including hardening standards and access controls', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 34, description: 'Identity and privileged access management for infrastructure components', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 35, description: 'Logging, monitoring, and centralized log management for infrastructure activities', requestDate: '2026-02-02', status: 'pending', remarks: '' }
                ]
            },
            {
                id: 'platforms',
                name: 'Platforms and IT Solution Operations',
                requirements: [
                    { id: 1, description: 'Approved organizational structure of the department (showing reporting lines)', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 2, description: 'Approved platform and solution strategy aligned with business objectives', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 3, description: 'Approved policies and procedures', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 4, description: 'Approved functional statement defining the department’s roles and responsibilities', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 5, description: 'Approved department objectives aligned with the company’s strategic objectives', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 6, description: 'Approved list of key performance indicators (KPIs) and performance metrics used by the department', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 7, description: 'Approved Job Descriptions (JDs) for department employees', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 8, description: 'Department risk register', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 9, description: 'List of all reports generated by the department (including report type, purpose, frequency, and target audience), with samples of those reports', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 10, description: 'Approved department annual plan / work plan', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 11, description: 'Latest Internal Audit reports relevant to the department and other reports from other assurance providers, if applicable', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 12, description: 'List of external stakeholders, regulators, and oversight bodies the department interacts with', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 13, description: 'Approved Delegation of Authority (DoA) and/or RACI matrix applicable to the department (if available)', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 14, description: 'Defined ownership for each platform and IT solution, including business and technical owners', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 15, description: 'Documentation and knowledge transfer for platforms and IT solutions', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 16, description: 'Complete inventory of all platforms and IT solutions, including purpose, criticality, and users', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 17, description: 'Classification of platforms and IT solutions based on business criticality and data sensitivity', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 18, description: 'Defined lifecycle management process for platforms and IT solutions, including development, maintenance, and deactivation', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 19, description: 'Segregation of environments and access controls between environments', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 20, description: 'Data protection controls, including encryption, masking, and secure data handling', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 21, description: 'Application and platform logging, monitoring, and alerting mechanisms', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 22, description: 'Performance monitoring and capacity management for platforms and IT solutions', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 23, description: 'Patch and vulnerability management for platforms, middleware, and application components', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 24, description: 'Regular security testing (e.g., VA/PT, code scanning)', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 25, description: 'Backup and recovery processes for platforms and application data', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 26, description: 'Disaster recovery and business continuity plans covering platforms and IT solutions', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 27, description: 'Defined SLAs and support agreements for platforms and IT solutions', requestDate: '2026-02-02', status: 'pending', remarks: '' }
                ]
            },
            {
                id: 'quality-assurance',
                name: 'Quality Assurance',
                requirements: [
                    { id: 1, description: 'Approved organizational structure of the department (showing reporting lines)', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 2, description: 'Approved policies and procedures', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 3, description: 'Approved functional statement defining the department’s roles and responsibilities', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 4, description: 'Approved department objectives aligned with the company’s strategic objectives', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 5, description: 'Approved list of key performance indicators (KPIs) and performance metrics used by the department', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 6, description: 'Approved Job Descriptions (JDs) for department employees', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 7, description: 'Department risk register', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 8, description: 'List of all reports generated by the department (including report type, purpose, frequency, and target audience), with samples of those reports', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 9, description: 'Approved department annual plan / work plan', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 10, description: 'Latest Internal Audit reports relevant to the department and other reports from other assurance providers, if applicable', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 11, description: 'List of external stakeholders, regulators, and oversight bodies the department interacts with', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 12, description: 'List of applicable laws, regulations, and other mandatory compliance obligations monitored by the department in relation to its operations', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 13, description: 'Approved Delegation of Authority (DoA) and/or RACI matrix applicable to the department (if available)', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 14, description: 'Defined test environments and readiness criteria', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 15, description: 'Functional testing processes to validate business and system requirements', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 16, description: 'Test execution tracking and reporting mechanisms', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 17, description: 'Formal go-live readiness and release quality assessment during 2025', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 18, description: 'Validation of fixes and re-testing evidence during 2025', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 19, description: 'Independent QA reviews and quality audits over IT systems and solutions', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 20, description: 'Post-implementation reviews to assess quality outcomes', requestDate: '2026-02-02', status: 'pending', remarks: '' }
                ]
            },
            {
                id: 'solution-dev',
                name: 'Solution Development & Delivery',
                requirements: [
                    { id: 1, description: 'Approved organizational structure of the department (showing reporting lines)', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 2, description: 'Approved policies and procedures', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 3, description: 'Approved functional statement defining the department\'s roles and responsibilities', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 4, description: 'Approved department objectives aligned with the company\'s strategic objectives', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 5, description: 'Approved list of key performance indicators (KPIs) and performance metrics used by the department', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 6, description: 'Approved Job Descriptions (JDs) for department employees', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 7, description: 'Department risk register', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 8, description: 'List of all reports generated by the department (including report type, purpose, frequency, and target audience), with samples of those reports', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 9, description: 'Approved department annual plan / work plan', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 10, description: 'Latest Internal Audit reports relevant to the department and other reports from other assurance providers, if applicable', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 11, description: 'List of external stakeholders, regulators, and oversight bodies the department interacts with', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 12, description: 'List of applicable laws, regulations, and other mandatory compliance obligations monitored by the department in relation to its operations', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 13, description: 'Approved Delegation of Authority (DoA) and/or RACI matrix applicable to the department (if available)', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 14, description: 'Defined prioritization and approval mechanisms for development initiatives', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 15, description: 'Documented business case and requirements approval process', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 16, description: 'Documented software development lifecycle (SDLC) methodology (e.g., Agile, Waterfall, Hybrid)', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 17, description: 'Configuration and release management for solutions', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 18, description: 'Go-live readiness assessment and formal approval. During 2025', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 19, description: 'Knowledge transfer to operations and support teams. During 2025', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 20, description: 'Application security testing and vulnerability remediation during development. During 2025', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 21, description: 'Vendor and third-party management for outsourced or packaged solutions', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 22, description: 'SLA and support model definition prior to solution deployment', requestDate: '2026-02-02', status: 'pending', remarks: '' }
                ]
            },
            {
                id: 'tech-strategy',
                name: 'Tech Strategy & Enterprise Architecture',
                requirements: [
                    { id: 1, description: 'Approved policies and procedures', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 2, description: 'Approved functional statement defining the department\'s roles and responsibilities', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 3, description: 'Approved department objectives aligned with the company\'s strategic objectives', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 4, description: 'Approved list of key performance indicators (KPIs) and performance metrics used by the department', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 5, description: 'Approved Job Descriptions (JDs) for department employees', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 6, description: 'Department risk register', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 7, description: 'List of all reports generated by the department (including report type, purpose, frequency, and target audience), with samples of those reports', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 8, description: 'Approved department annual plan / work plan', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 9, description: 'Latest Internal Audit reports relevant to the department and other reports from other assurance providers, if applicable', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 10, description: 'List of external stakeholders, regulators, and oversight bodies the department interacts with', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 11, description: 'List of applicable laws, regulations, and other mandatory compliance obligations monitored by the department in relation to its operations', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 12, description: 'Approved Delegation of Authority (DoA) and/or RACI matrix applicable to the department (if available)', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 13, description: 'Approved organizational structure of the department (showing reporting lines)', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 14, description: 'Formal architecture decision-making and escalation mechanisms. During 2025, if any', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 15, description: 'Documented current-state architecture across business, application, data, and technology layers', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 16, description: 'Defined current and target state architecture', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 17, description: 'Gap analysis between current and target architecture states', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 18, description: 'Standardized enterprise architecture framework and methodology (e.g., TOGAF or equivalent)', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 19, description: 'Approved architecture standards, principles, and design patterns', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 20, description: 'Integration of EA reviews within solution development and delivery lifecycle. During 2025', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 21, description: 'Performance, scalability, resilience, and availability considerations in architecture design', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 22, description: 'Security-by-design and privacy-by-design principles embedded in architecture', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 23, description: 'Architecture documentation management and repository usage', requestDate: '2026-02-02', status: 'pending', remarks: '' },
                    { id: 24, description: 'Regular review and update of technology strategy and enterprise architecture artifacts', requestDate: '2026-02-02', status: 'pending', remarks: '' }
                ]
            }
        ];

        // State management
        let currentDeptIndex = 0;
        let currentPage = 1;
        const itemsPerPage = 10;
        let currentRequirementId = null;
        let filteredRequirements = [];
        let uploadedFiles = [];

        // DOM elements
        const departmentTabs = document.getElementById('department-tabs');
        const requirementsTable = document.getElementById('requirements-table');
        const departmentTitle = document.getElementById('department-title');
        const currentDeptElement = document.getElementById('current-dept');
        const statusFilter = document.getElementById('status-filter');
        const totalReqsElement = document.getElementById('total-reqs');
        const pendingReqsElement = document.getElementById('pending-reqs');
        const progressReqsElement = document.getElementById('progress-reqs');
        const completedReqsElement = document.getElementById('completed-reqs');
        const uploadModal = document.getElementById('upload-modal');
        const closeModal = document.getElementById('close-modal');
        const cancelModal = document.getElementById('cancel-modal');
        const modalTitle = document.getElementById('modal-title');
        const requirementTitle = document.getElementById('requirement-title');
        const requirementDetail = document.getElementById('requirement-detail');
        const statusButtons = document.querySelectorAll('.status-btn');
        const receivingDate = document.getElementById('receiving-date');
        const remarks = document.getElementById('remarks');
        const saveStatusBtn = document.getElementById('save-status');
        const submitStatusBtn = document.getElementById('submit-status');
        const confirmationToast = document.getElementById('confirmation-toast');
        const prevPageBtn = document.getElementById('prev-page');
        const nextPageBtn = document.getElementById('next-page');
        const startItemElement = document.getElementById('start-item');
        const endItemElement = document.getElementById('end-item');
        const totalItemsElement = document.getElementById('total-items');
        const submitAllBtn = document.getElementById('submit-all-btn');
        const exportBtn = document.getElementById('export-btn');
        const fileUpload = document.getElementById('file-upload');
        const fileList = document.getElementById('file-list');

        // Initialize the app
        function init() {
            renderDepartmentTabs();
            loadDepartment(currentDeptIndex);
            setupEventListeners();
        }

        // Render department tabs
        function renderDepartmentTabs() {
            departmentTabs.innerHTML = '';
            
            departments.forEach((dept, index) => {
                const tab = document.createElement('button');
                tab.className = `px-4 py-2 rounded-t-lg font-medium ${index === currentDeptIndex ? 'tab-active bg-white border-t border-l border-r border-gray-200' : 'text-gray-600 hover:text-gray-800 hover:bg-gray-100'}`;
                tab.textContent = dept.name;
                tab.dataset.index = index;
                tab.addEventListener('click', () => {
                    currentDeptIndex = index;
                    currentPage = 1;
                    loadDepartment(currentDeptIndex);
                    // Update active tab
                    document.querySelectorAll('#department-tabs button').forEach((t, i) => {
                        if (i === index) {
                            t.classList.add('tab-active', 'bg-white', 'border-t', 'border-l', 'border-r', 'border-gray-200');
                            t.classList.remove('text-gray-600', 'hover:text-gray-800', 'hover:bg-gray-100');
                        } else {
                            t.classList.remove('tab-active', 'bg-white', 'border-t', 'border-l', 'border-r', 'border-gray-200');
                            t.classList.add('text-gray-600', 'hover:text-gray-800', 'hover:bg-gray-100');
                        }
                    });
                });
                
                departmentTabs.appendChild(tab);
            });
        }

        // Load department data
        function loadDepartment(index) {
            const dept = departments[index];
            departmentTitle.textContent = `${dept.name} - Requirements`;
            currentDeptElement.textContent = dept.name;
            
            // Update stats
            updateStats(dept);
            
            // Apply current filter
            applyFilter();
            
            // Render table
            renderTable();
        }

        // Update statistics
        function updateStats(dept) {
            const total = dept.requirements.length;
            const pending = dept.requirements.filter(req => req.status === 'pending').length;
            const inProgress = dept.requirements.filter(req => req.status === 'in-progress').length;
            const completed = dept.requirements.filter(req => req.status === 'completed').length;
            
            totalReqsElement.textContent = total;
            pendingReqsElement.textContent = pending;
            progressReqsElement.textContent = inProgress;
            completedReqsElement.textContent = completed;
        }

        // Apply status filter
        function applyFilter() {
            const dept = departments[currentDeptIndex];
            const filterValue = statusFilter.value;
            
            if (filterValue === 'all') {
                filteredRequirements = [...dept.requirements];
            } else {
                filteredRequirements = dept.requirements.filter(req => req.status === filterValue);
            }
            
            totalItemsElement.textContent = filteredRequirements.length;
            currentPage = 1;
            updatePagination();
        }

        // Render requirements table
        function renderTable() {
            requirementsTable.innerHTML = '';
            
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = Math.min(startIndex + itemsPerPage, filteredRequirements.length);
            
            for (let i = startIndex; i < endIndex; i++) {
                const req = filteredRequirements[i];
                const row = document.createElement('tr');
                row.className = i % 2 === 0 ? 'bg-white' : 'bg-gray-50';
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${req.id}</td>
                    <td class="px-6 py-4 text-sm text-gray-700">${req.description}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">${formatDate(req.requestDate)}</td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="px-3 py-1 rounded-full text-xs font-medium ${getStatusClass(req.status)}">
                            ${getStatusText(req.status)}
                        </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                        <button class="text-blue-600 hover:text-blue-900 mr-3 update-btn" data-id="${req.id}">
                            <i class="fas fa-edit mr-1"></i> Update
                        </button>
                        <button class="text-gray-600 hover:text-gray-900 view-btn" data-id="${req.id}">
                            <i class="fas fa-eye mr-1"></i> View
                        </button>
                    </td>
                `;
                
                requirementsTable.appendChild(row);
            }
            
            // Add event listeners to buttons
            document.querySelectorAll('.update-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    openUpdateModal(parseInt(this.dataset.id));
                });
            });
            
            document.querySelectorAll('.view-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    openViewModal(parseInt(this.dataset.id));
                });
            });
            
            // Update pagination info
            startItemElement.textContent = filteredRequirements.length > 0 ? startIndex + 1 : 0;
            endItemElement.textContent = endIndex;
        }

        // Format date
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', { 
                year: 'numeric', 
                month: 'short', 
                day: 'numeric' 
            });
        }

        // Get status class
        function getStatusClass(status) {
            switch(status) {
                case 'pending': return 'status-pending';
                case 'in-progress': return 'status-in-progress';
                case 'completed': return 'status-completed';
                case 'overdue': return 'status-overdue';
                default: return 'bg-gray-200 text-gray-800';
            }
        }

        // Get status text
        function getStatusText(status) {
            switch(status) {
                case 'pending': return 'Pending';
                case 'in-progress': return 'In Progress';
                case 'completed': return 'Completed';
                case 'overdue': return 'Overdue';
                default: return status;
            }
        }

        // Open update modal
        function openUpdateModal(id) {
            const dept = departments[currentDeptIndex];
            const requirement = dept.requirements.find(req => req.id === id);
            
            if (!requirement) return;
            
            currentRequirementId = id;
            modalTitle.textContent = 'Update Requirement Status';
            requirementTitle.textContent = requirement.description;
            requirementDetail.textContent = `${dept.name} - Requirement #${id}`;
            
            // Reset form
            remarks.value = requirement.remarks || '';
            receivingDate.value = '';
            uploadedFiles = [];
            fileList.innerHTML = '';
            
            // Set active status button
            statusButtons.forEach(btn => {
                if (btn.dataset.status === requirement.status) {
                    btn.classList.add('border-2', 'border-blue-500');
                } else {
                    btn.classList.remove('border-2', 'border-blue-500');
                }
            });
            
            uploadModal.classList.remove('hidden');
        }

        // Open view modal
        function openViewModal(id) {
            const dept = departments[currentDeptIndex];
            const requirement = dept.requirements.find(req => req.id === id);
            
            if (!requirement) return;
            
            currentRequirementId = id;
            modalTitle.textContent = 'View Requirement Details';
            requirementTitle.textContent = requirement.description;
            requirementDetail.textContent = `${dept.name} - Requirement #${id}`;
            
            // Set form values (readonly)
            remarks.value = requirement.remarks || '';
            receivingDate.value = '';
            
            // Set active status button
            statusButtons.forEach(btn => {
                if (btn.dataset.status === requirement.status) {
                    btn.classList.add('border-2', 'border-blue-500');
                } else {
                    btn.classList.remove('border-2', 'border-blue-500');
                }
            });
            
            // Disable form elements for view mode
            statusButtons.forEach(btn => btn.disabled = true);
            receivingDate.disabled = true;
            remarks.disabled = true;
            saveStatusBtn.classList.add('hidden');
            submitStatusBtn.classList.add('hidden');
            
            uploadModal.classList.remove('hidden');
        }

        // Update pagination
        function updatePagination() {
            const totalPages = Math.ceil(filteredRequirements.length / itemsPerPage);
            
            prevPageBtn.disabled = currentPage === 1;
            nextPageBtn.disabled = currentPage === totalPages || totalPages === 0;
            
            if (totalPages === 0) {
                startItemElement.textContent = 0;
                endItemElement.textContent = 0;
            }
        }

        // Setup event listeners
        function setupEventListeners() {
            // Status filter change
            statusFilter.addEventListener('change', () => {
                applyFilter();
                renderTable();
            });
            
            // Status buttons in modal
            statusButtons.forEach(btn => {
                btn.addEventListener('click', function() {
                    statusButtons.forEach(b => b.classList.remove('border-2', 'border-blue-500'));
                    this.classList.add('border-2', 'border-blue-500');
                });
            });
            
            // Close modal buttons
            closeModal.addEventListener('click', closeModalFunc);
            cancelModal.addEventListener('click', closeModalFunc);
            
            // Save status button
            saveStatusBtn.addEventListener('click', saveStatus);
            
            // Submit status button
            submitStatusBtn.addEventListener('click', submitStatus);
            
            // Pagination buttons
            prevPageBtn.addEventListener('click', () => {
                if (currentPage > 1) {
                    currentPage--;
                    renderTable();
                    updatePagination();
                }
            });
            
            nextPageBtn.addEventListener('click', () => {
                const totalPages = Math.ceil(filteredRequirements.length / itemsPerPage);
                if (currentPage < totalPages) {
                    currentPage++;
                    renderTable();
                    updatePagination();
                }
            });
            
            // Submit all button
            submitAllBtn.addEventListener('click', submitAllRequirements);
            
            // Export button
            exportBtn.addEventListener('click', exportData);
            
            // File upload
            fileUpload.addEventListener('change', handleFileUpload);
            
            // Close modal when clicking outside
            window.addEventListener('click', (e) => {
                if (e.target === uploadModal) {
                    closeModalFunc();
                }
            });
        }

        // Close modal function
        function closeModalFunc() {
            uploadModal.classList.add('hidden');
            // Re-enable form elements if they were disabled in view mode
            statusButtons.forEach(btn => btn.disabled = false);
            receivingDate.disabled = false;
            remarks.disabled = false;
            saveStatusBtn.classList.remove('hidden');
            submitStatusBtn.classList.remove('hidden');
        }

        // Save status
        function saveStatus() {
            const dept = departments[currentDeptIndex];
            const requirement = dept.requirements.find(req => req.id === currentRequirementId);
            
            if (!requirement) return;
            
            // Get selected status
            let selectedStatus = 'pending';
            statusButtons.forEach(btn => {
                if (btn.classList.contains('border-2')) {
                    selectedStatus = btn.dataset.status;
                }
            });
            
            // Update requirement
            requirement.status = selectedStatus;
            requirement.remarks = remarks.value;
            
            // Update stats
            updateStats(dept);
            
            // Re-apply filter and render table
            applyFilter();
            renderTable();
            
            // Show confirmation
            showConfirmation('Status updated successfully!');
            
            // Close modal
            closeModalFunc();
        }

        // Submit status (with simulated upload)
        function submitStatus() {
            const dept = departments[currentDeptIndex];
            const requirement = dept.requirements.find(req => req.id === currentRequirementId);
            
            if (!requirement) return;
            
            // Get selected status
            let selectedStatus = 'pending';
            statusButtons.forEach(btn => {
                if (btn.classList.contains('border-2')) {
                    selectedStatus = btn.dataset.status;
                }
            });
            
            // For submission, we'll set it to completed if not already
            if (selectedStatus !== 'completed') {
                selectedStatus = 'completed';
                
                // Update status button UI
                statusButtons.forEach(btn => {
                    btn.classList.remove('border-2', 'border-blue-500');
                    if (btn.dataset.status === 'completed') {
                        btn.classList.add('border-2', 'border-blue-500');
                    }
                });
            }
            
            // Update requirement
            requirement.status = selectedStatus;
            requirement.remarks = remarks.value;
            
            // Set receiving date to today if completed
            if (selectedStatus === 'completed') {
                const today = new Date();
                requirement.receivingDate = today.toISOString().split('T')[0];
                receivingDate.value = requirement.receivingDate;
            }
            
            // Update stats
            updateStats(dept);
            
            // Re-apply filter and render table
            applyFilter();
            renderTable();
            
            // Show confirmation with upload simulation
            showConfirmation('Requirement submitted successfully! Files uploaded: ' + uploadedFiles.length);
            
            // Close modal
            closeModalFunc();
        }

        // Submit all requirements
        function submitAllRequirements() {
            const dept = departments[currentDeptIndex];
            const pendingReqs = dept.requirements.filter(req => req.status === 'pending');
            
            if (pendingReqs.length === 0) {
                alert('No pending requirements to submit!');
                return;
            }
            
            if (confirm(`Are you sure you want to submit all ${pendingReqs.length} pending requirements?`)) {
                // Simulate submission
                dept.requirements.forEach(req => {
                    if (req.status === 'pending') {
                        req.status = 'completed';
                        const today = new Date();
                        req.receivingDate = today.toISOString().split('T')[0];
                    }
                });
                
                // Update stats
                updateStats(dept);
                
                // Re-apply filter and render table
                applyFilter();
                renderTable();
                
                showConfirmation(`All ${pendingReqs.length} requirements submitted successfully!`);
            }
        }

        // Export data
        function exportData() {
            const dept = departments[currentDeptIndex];
            
            // Create CSV content
            let csvContent = "Sr. No.,Information Requested,Request Date,Status,Remarks\n";
            
            dept.requirements.forEach(req => {
                csvContent += `${req.id},"${req.description}","${formatDate(req.requestDate)}","${getStatusText(req.status)}","${req.remarks || ''}"\n`;
            });
            
            // Create download link
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${dept.name.replace(/\s+/g, '_')}_Audit_Requirements.csv`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
            
            showConfirmation('Data exported successfully!');
        }

        // Handle file upload
        function handleFileUpload() {
            const files = Array.from(fileUpload.files);
            
            files.forEach(file => {
                if (file.size > 10 * 1024 * 1024) {
                    alert(`File ${file.name} is too large. Maximum size is 10MB.`);
                    return;
                }
                
                const allowedTypes = ['application/pdf', 'application/msword', 'application/vnd.openxmlformats-officedocument.wordprocessingml.document', 
                                      'application/vnd.ms-excel', 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',
                                      'image/jpeg', 'image/png'];
                
                if (!allowedTypes.includes(file.type)) {
                    alert(`File ${file.name} has an unsupported format.`);
                    return;
                }
                
                uploadedFiles.push(file);
                
                // Add to file list
                const fileItem = document.createElement('div');
                fileItem.className = 'flex items-center justify-between p-2 bg-gray-50 rounded';
                fileItem.innerHTML = `
                    <div class="flex items-center">
                        <i class="fas fa-file text-gray-500 mr-2"></i>
                        <span class="text-sm">${file.name}</span>
                        <span class="text-xs text-gray-500 ml-2">(${(file.size / 1024).toFixed(1)} KB)</span>
                    </div>
                    <button class="text-red-500 hover:text-red-700 remove-file" data-name="${file.name}">
                        <i class="fas fa-times"></i>
                    </button>
                `;
                
                fileList.appendChild(fileItem);
            });
            
            // Add event listeners to remove buttons
            document.querySelectorAll('.remove-file').forEach(btn => {
                btn.addEventListener('click', function() {
                    const fileName = this.dataset.name;
                    uploadedFiles = uploadedFiles.filter(f => f.name !== fileName);
                    this.parentElement.remove();
                });
            });
            
            // Reset file input
            fileUpload.value = '';
        }

        // Show confirmation toast
        function showConfirmation(message) {
            const toast = confirmationToast;
            const toastMessage = toast.querySelector('p:first-child');
            toastMessage.textContent = message;
            
            toast.classList.remove('hidden');
            
            setTimeout(() => {
                toast.classList.add('hidden');
            }, 3000);
        }

        // Initialize the app
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>