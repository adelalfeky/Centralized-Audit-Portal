const sqlite3 = require('sqlite3').verbose();
const path = require('path');

const dbPath = path.join(__dirname, 'kpmg_grc.db');
const db = new sqlite3.Database(dbPath);

// Sample requirements for each department
const departmentRequirements = {
    2: { // Corporate IT
        name: 'Corporate IT',
        requirements: [
            'Approved Org structure',
            'Approved Strategy',
            'Approved policies and procedures',
            'Approved functional statement defining the department\'s roles and responsibilities',
            'Approved department objectives aligned with the company\'s strategic objectives',
            'Approved list of key performance indicators (KPIs) and performance metrics used by the department',
            'Approved Job Descriptions (JDs) for department employees',
            'Department risk register',
            'List of all reports generated by the department (including report type, purpose, frequency, and target audience), with samples of those reports',
            'Approved department annual plan / work plan',
            'Latest Internal Audit reports relevant to the department and other reports from other assurance providers, if applicable',
            'List of external stakeholders, regulators, and oversight bodies the department interacts with',
            'List of applicable laws, regulations, and other mandatory compliance obligations monitored by the department in relation to its operations',
            'Approved Delegation of Authority (DoA) and/or RACI matrix applicable to the department (if available)',
            'IT Enterprise Architecture document',
            'IT budget for 2025',
            'IT service catalogue',
            'Service Level Agreements between IT and business departments',
            'List of IT projects in 2025',
            'IT performance report (servers utilization, UPS, capacity reports)'
        ]
    },
    3: { // Data Analytics
        name: 'Data Analytics & Business Intelligence',
        requirements: [
            'Data governance policies and procedures',
            'Approved functional statement defining the department\'s roles and responsibilities',
            'Approved department objectives aligned with the company\'s strategic objectives',
            'Approved list of key performance indicators (KPIs) and performance metrics used by the department',
            'Approved Job Descriptions (JDs) for department employees',
            'Department risk register',
            'List of all reports generated by the department (including report type, purpose, frequency, and target audience), with samples of those reports',
            'Approved department annual plan / work plan',
            'Latest Internal Audit reports relevant to the department and other reports from other assurance providers, if applicable',
            'List of external stakeholders, regulators, and oversight bodies the department interacts with',
            'List of applicable laws, regulations, and other mandatory compliance obligations monitored by the department in relation to its operations',
            'Approved Delegation of Authority (DoA) and/or RACI matrix applicable to the department (if available)',
            'Approved organizational structure of the department (showing reporting lines)',
            'Approved Data Analytics & Business Intelligence framework and operating model',
            'Defined roles and responsibilities (data owners, data stewards, BI developers)',
            'Documented data architecture (source systems, data warehouse, data marts)',
            'Data integration and ETL processes documentation',
            'List of all data sources feeding BI solutions',
            'Data lineage and dependency mapping',
            'Data quality framework and standards'
        ]
    },
    4: { // Infrastructure
        name: 'Infrastructure & Operations',
        requirements: [
            'Approved org structure',
            'Approved policies and procedures',
            'Approved functional statement defining the department\'s roles and responsibilities',
            'Approved department objectives aligned with the company\'s strategic objectives',
            'Approved list of key performance indicators (KPIs) and performance metrics used by the department',
            'Approved Job Descriptions (JDs) for department employees',
            'Department risk register',
            'List of all reports generated by the department (including report type, purpose, frequency, and target audience), with samples of those reports',
            'Approved department annual plan / work plan',
            'Latest Internal Audit reports relevant to the department and other reports from other assurance providers, if applicable',
            'List of external stakeholders, regulators, and oversight bodies the department interacts with',
            'List of applicable laws, regulations, and other mandatory compliance obligations monitored by the department in relation to its operations',
            'Approved Delegation of Authority (DoA) and/or RACI matrix applicable to the department (if available)',
            'Approved organizational structure of the department (showing reporting lines)',
            'Approved IT performance metrics',
            'IT performance report (servers utilization, UPS, capacity reports)',
            'Monitoring tools for infrastructure availability and performance',
            'Samples of IT performance reports / emails',
            'List of backup performed in 2025',
            'List of backup restoration process performed in 2025'
        ]
    },
    5: { // Platforms
        name: 'Platforms and IT Solution Operations',
        requirements: [
            'Approved organizational structure of the department (showing reporting lines)',
            'Approved platform and solution strategy aligned with business objectives',
            'Approved policies and procedures',
            'Approved functional statement defining the department\'s roles and responsibilities',
            'Approved department objectives aligned with the company\'s strategic objectives',
            'Approved list of key performance indicators (KPIs) and performance metrics used by the department',
            'Approved Job Descriptions (JDs) for department employees',
            'Department risk register',
            'List of all reports generated by the department (including report type, purpose, frequency, and target audience), with samples of those reports',
            'Approved department annual plan / work plan',
            'Latest Internal Audit reports relevant to the department and other reports from other assurance providers, if applicable',
            'List of external stakeholders, regulators, and oversight bodies the department interacts with',
            'Approved Delegation of Authority (DoA) and/or RACI matrix applicable to the department (if available)',
            'Defined ownership for each platform and IT solution, including business and technical owners',
            'Documentation and knowledge transfer for platforms and IT solutions',
            'Complete inventory of all platforms and IT solutions, including purpose, criticality, and users',
            'Classification of platforms and IT solutions based on business criticality and data sensitivity',
            'Defined lifecycle management process for platforms and IT solutions, including development, maintenance, and deactivation',
            'Segregation of environments and access controls between environments',
            'Data protection controls, including encryption, masking, and secure data handling'
        ]
    },
    6: { // QA
        name: 'Quality Assurance',
        requirements: [
            'Approved organizational structure of the department (showing reporting lines)',
            'Approved policies and procedures',
            'Approved functional statement defining the department\'s roles and responsibilities',
            'Approved department objectives aligned with the company\'s strategic objectives',
            'Approved list of key performance indicators (KPIs) and performance metrics used by the department',
            'Approved Job Descriptions (JDs) for department employees',
            'Department risk register',
            'List of all reports generated by the department (including report type, purpose, frequency, and target audience), with samples of those reports',
            'Approved department annual plan / work plan',
            'Latest Internal Audit reports relevant to the department and other reports from other assurance providers, if applicable',
            'List of external stakeholders, regulators, and oversight bodies the department interacts with',
            'List of applicable laws, regulations, and other mandatory compliance obligations monitored by the department in relation to its operations',
            'Approved Delegation of Authority (DoA) and/or RACI matrix applicable to the department (if available)',
            'Defined test environments and readiness criteria',
            'Functional testing processes to validate business and system requirements',
            'Test execution tracking and reporting mechanisms',
            'Formal go-live readiness and release quality assessment during 2025',
            'Validation of fixes and re-testing evidence during 2025',
            'Independent QA reviews and quality audits over IT systems and solutions',
            'Post-implementation reviews to assess quality outcomes'
        ]
    },
    7: { // Solution Dev
        name: 'Solution Development & Delivery',
        requirements: [
            'Approved organizational structure of the department (showing reporting lines)',
            'Approved policies and procedures',
            'Approved functional statement defining the department\'s roles and responsibilities',
            'Approved department objectives aligned with the company\'s strategic objectives',
            'Approved list of key performance indicators (KPIs) and performance metrics used by the department',
            'Approved Job Descriptions (JDs) for department employees',
            'Department risk register',
            'List of all reports generated by the department (including report type, purpose, frequency, and target audience), with samples of those reports',
            'Approved department annual plan / work plan',
            'Latest Internal Audit reports relevant to the department and other reports from other assurance providers, if applicable',
            'List of external stakeholders, regulators, and oversight bodies the department interacts with',
            'List of applicable laws, regulations, and other mandatory compliance obligations monitored by the department in relation to its operations',
            'Approved Delegation of Authority (DoA) and/or RACI matrix applicable to the department (if available)',
            'Defined prioritization and approval mechanisms for development initiatives',
            'Documented business case and requirements approval process',
            'Documented software development lifecycle (SDLC) methodology (e.g., Agile, Waterfall, Hybrid)',
            'Configuration and release management for solutions',
            'Go-live readiness assessment and formal approval during 2025',
            'Knowledge transfer to operations and support teams during 2025',
            'Application security testing and vulnerability remediation during development during 2025'
        ]
    },
    8: { // Tech Strategy
        name: 'Tech Strategy & Enterprise Architecture',
        requirements: [
            'Approved policies and procedures',
            'Approved functional statement defining the department\'s roles and responsibilities',
            'Approved department objectives aligned with the company\'s strategic objectives',
            'Approved list of key performance indicators (KPIs) and performance metrics used by the department',
            'Approved Job Descriptions (JDs) for department employees',
            'Department risk register',
            'List of all reports generated by the department (including report type, purpose, frequency, and target audience), with samples of those reports',
            'Approved department annual plan / work plan',
            'Latest Internal Audit reports relevant to the department and other reports from other assurance providers, if applicable',
            'List of external stakeholders, regulators, and oversight bodies the department interacts with',
            'List of applicable laws, regulations, and other mandatory compliance obligations monitored by the department in relation to its operations',
            'Approved Delegation of Authority (DoA) and/or RACI matrix applicable to the department (if available)',
            'Approved organizational structure of the department (showing reporting lines)',
            'Formal architecture decision-making and escalation mechanisms during 2025, if any',
            'Documented current-state architecture across business, application, data, and technology layers',
            'Defined current and target state architecture',
            'Gap analysis between current and target architecture states',
            'Standardized enterprise architecture framework and methodology (e.g., TOGAF or equivalent)',
            'Approved architecture standards, principles, and design patterns',
            'Integration of EA reviews within solution development and delivery lifecycle during 2025'
        ]
    }
};

db.serialize(() => {
    db.run('pragma foreign_keys = on');
    
    // Delete existing requirements
    db.run('DELETE FROM requirements', (err) => {
        if (err) console.error('Error deleting requirements:', err);
    });
    
    // Insert new requirements
    let inserted = 0;
    for (const [deptId, deptData] of Object.entries(departmentRequirements)) {
        deptData.requirements.forEach((description, idx) => {
            db.run(
                'INSERT INTO requirements (departmentId, description, requestDate, status) VALUES (?, ?, ?, ?)',
                [parseInt(deptId), description, '2026-02-02', 'pending'],
                function(err) {
                    if (err) {
                        console.error(`Error inserting requirement for dept ${deptId}:`, err);
                    } else {
                        inserted++;
                    }
                }
            );
        });
    }
    
    setTimeout(() => {
        console.log(`âœ… Successfully inserted ${inserted} requirements`);
        db.close();
    }, 1000);
});
